<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8" />
    <title>Global Covid-19 Vaccine Apartheid</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <link
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      rel="stylesheet"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css?family=Work+Sans:400,500,600"
      rel="stylesheet"
      type="text/css"
    />

    <link
      href="css/styles.css"
      rel="stylesheet"
    />

  </head>

  <body>
    <div class="container-fluid">

      <header class="row py-2 bg-dark text-white" id="header">
        <h1>Global Covid-19 Vaccine Apartheid</h1>
      </header>

      <div class="row">
        <div id="content" class="col-md-4 py-2 overflow-scroll">
        <h1>A Deadly 'Pathology of Power'</h1>
          <p>
          <u>How to use this visualization</u>
          <br>
          Drag the slider to see how national vaccination rates have changed over time.
          For a snapshot of inoculation trends in a given country, hover over the map.
          </p>
          <p>
          Click the dropdown menu to explore WTO members' positions on a proposed intellectual property waiver first
          introduced by India and South Africa on October 2, 2020, when the pandemic death toll had just surpassed 1 million.
          </p>
          <p>
          <u>Background</u>
          <br>
          Will add more later
          </p>
          <p>
          <u>Sources</u>
          <br>
          Vaccination rates came courtesy of <a href='https://github.com/owid/covid-19-data/tree/master/public/data' target="blank"> Our World in Data</a> - see Mathieu, E., Ritchie, H., Ortiz-Ospina, E. et al. A global database of COVID-19 vaccinations. Nat Hum Behav (2021);
          Information about whether governments support or oppose the TRIPS waiver proposal was supplied by <a href='https://msfaccess.org/no-patents-no-monopolies-pandemic' target="blank"> Doctors Without Borders</a>;
          Finally, <a href='https://www.naturalearthdata.com/downloads/50m-cultural-vectors/' target="blank">Natural Earth</a> provided national boundaries
          and <a href='https://gavinr.com/open-data/world-countries-centroids/' target="blank">Gavin Rehkemper</a> provided country centroids.
          </p>
        </div>

        <div class="col-md-9 p-0">
          <div id="map"></div>

          <div id="slider">
            <label><span class="min">Dec 2020</span><span class="max">Present</span>

            </label>

          </div>
        </div>
      </div>

      <footer class="footer fixed-bottom bg-dark" id="footer">
        <div class="row">
          <div class="col-12 text-center text-white pt-2">
            Map authored by <a href="https://kwstancil.github.io/map-portfolio/">Kenny Stancil</a>
          </div>
        </div>
      </footer>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous">
    </script>

    <script
      src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
      integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
      crossorigin="">
    </script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.min.js"
      integrity="sha512-EbdJQSugx0nVWrtyK3JdQQ/03mS3Q1UiAhRtErbwl1YL/+e2hZdlIcSURxxh7WXHTzn83sjlh2rysACoJGfb6g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer">
    </script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.1.1/d3.min.js"
      integrity="sha512-COTaPOlz12cG4fSfcBsxZsjauBAyldqp+8FQUM/dZHm+ts/jR4AFoJhCqxy8K10Jrf3pojfsbq7fAPTb1XaVkg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer">
    </script>

    <script src="https://d3js.org/d3.v7.js"></script>

    <script src="https://unpkg.com/topojson@3"></script>

    <script src ="js/app.js"></script>

    <script>
      // map options
      const options = {
        scrollWheelZoom: true,
        zoomSnap: 0.1,
        dragging: true,
        zoomControl: false,
        // center: [39.6, -94.46],
        // zoom: 4,
        // Manually set zoom and center to avoid map spanning the world
        // or set bounds on a predefined extent, map.fitBounds([[40, -100], [-40, -70]])
      };

      // create the Leaflet map
      const map = L.map("map", options);

      map.fitBounds([[45, -125], [30, -65]]) // diagonal corners on the bounding rectangle

      // request tiles and add to map
      const tiles = L.tileLayer(
        "http://{s}.tile.stamen.com/toner-background/{z}/{x}/{y}.{ext}", {
          attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
          subdomains: "abcd",
          ext: "png",
        }
      ).addTo(map);

      // AJAX request for GeoJSON data
      fetch("data/nation_states.json")
        .then(function (response) {
          return response.json();
        })
        .then(function (nations) {
          console.log(nations);

          Papa.parse('data/owid_covid_data.csv', {
            download: true,
            header: true,
            complete: function(data) {

              // data is accessible to us here
              console.log('data: ', data);

              // note that counties is also accessible here
              console.log('nations: ', nations);

              // create function to join data and nations
              processData(nations, data);
              }
            }); // end of Papa.parse()
          })
          .catch(function (error) {
            console.log(`Ruh roh! An error has occurred`, error);
          });

          function processData(nations, data) {

            // loop through the json
            for (var nation in nations.features) {

              var props = nations.features[nation].properties;

              //loop through csv data for each county
              for (var d in data.data) {

                if (props.SOV_AG == data.data[d].iso_code) { //  if the country name in the geojson matches the country name in the csv
                  nations.features[nation].properties = data.data[d]; // add csv data to json feature's properties
                  break;
                }
              }
            }

            // create empty array to store all the data values
            const rates = [];
            const t = {}
            // iterate through all the counties
            nations.features.forEach(function(nation) {

              // iterate through all the props of each county
              for (const prop in nation.properties) {

                // if the attribute is a number and not the country name
                if (prop != "SOV_AG" && prop != "iso_code")  {

                  if (nation.properties[prop] != null){

                  // push that attribute value into the array
                  rates.push(Number(nation.properties[prop]));
                }
                }
              }
            });

            // verufy the results
            console.log(t,rates.sort((a,b) => b - a));



    } // end processData()


    </script>
  </body>
</html>
